#include <stdio.h>
#include <stdlib.h>
#include <time.h>

typedef struct cardDeck {
    int suit; // 56,57,58,59 wrt, heart, spades,clubs,diamonds
    int value;// 1,2....10,11,12,13
} Deck;

void shuffleDeck(Deck* deck) {
    int i, j;
    Deck temp;
    for (i = 52 - 1; i > 0; i--) {
        j = rand() % (i + 1);
        temp = deck[i];
        deck[i] = deck[j];
        deck[j] = temp;
    }
}

void printDeck(Deck* deck, int numCards, int topDeck) {
    int i;
    for (i = topDeck; i < numCards + topDeck; i++) {
         if (deck[i].suit == 56) {
            if (deck[i].value <= 10)
                printf("♥  %d\n", deck[i].value);
            else if (deck[i].value == 11)
                printf("♥  J\n");
            else if (deck[i].value == 12)
                printf("♥  Q\n");
            else if (deck[i].value == 13)
                printf("♥  K\n");
        }
        if (deck[i].suit == 57) {
            if (deck[i].value <= 10)
                printf("♠  %d\n", deck[i].value);
            else if (deck[i].value == 11)
                printf("♠  J\n");
            else if (deck[i].value == 12)
                printf("♠  Q\n");
            else if (deck[i].value == 13)
                printf("♠  K\n");
        }
        if (deck[i].suit == 58) {
            if (deck[i].value <= 10)
                printf("♣  %d\n", deck[i].value);
            else if (deck[i].value == 11)
                printf("♣  J\n");
            else if (deck[i].value == 12)
                printf("♣  Q\n");
            else if (deck[i].value == 13)
                printf("♣  K\n");
        }
        if (deck[i].suit == 59) {
            if (deck[i].value <= 10)
                printf("◆  %d\n", deck[i].value);
            else if (deck[i].value == 11)
                printf("◆  J\n");
            else if (deck[i].value == 12)
                printf("◆  Q\n");
            else if (deck[i].value == 13)
                printf("◆  K\n");
        }
    }
}
void comparison(Deck userStack[50],Deck cpuStack[50]){
    
    int top, numCpu, numUser;
    int result;
    top = 0;
    numCpu = 4;
    numUser = 4;    

    printf("User Deck: *************** %d\n", numUser - top);
    printDeck(userStack, numUser,top);
         printf("CPU Deck: *************** %d\n",numCpu - top);
         printDeck(cpuStack,  numCpu,top);
    while (numCpu-top >= 0 && numUser-top >= 0 ){
        
         
        if (userStack[top].value > cpuStack[top].value){
            printf("User Wins\n");
            userStack[numUser].value = userStack[top].value;
            userStack[numUser].suit = userStack[top].suit;
            userStack[numUser+1].value = cpuStack[top].value;
            userStack[numUser+1].suit = cpuStack[top].suit;
            numCpu--;
            numUser+=2;
            top++;
        }
        else if (userStack[top].value < cpuStack[top].value){
            printf("CPU Wins\n");
            cpuStack[numCpu].value = cpuStack[top].value;
            cpuStack[numCpu].suit = cpuStack[top].suit;
            cpuStack[numCpu+1].value = userStack[top].value;
            cpuStack[numCpu+1].suit = userStack[top].suit;
            numUser--;
            numCpu+=2;
            top++;
        }
        // if tie flip another card
        /*else if (userStack[top].value == cpuStack[top].value){
            top++;
            while (userStack[top].value == cpuStack[top].value){
                if (userStack[top].value > cpuStack[top].value){
        
                    userStack[numUser+1] = cpuStack[top];
                    numCpu--;
                    top++;
                }
        
                else if (userStack[top].value < cpuStack[top].value){
                    cpuStack[numCpu+1] = userStack[top];
                    numUser--;
                    top++;
                }
            }
        }*/
        printf("\nUser Deck: *************** \n");
        printDeck(userStack, numUser+top,top);
        printf("\nCPU Deck: *************** \n");
        printDeck(cpuStack, numCpu+top,top);
        printf("Hit enter for results of the next round!\n");
        scanf("%*c");
    }
    
    if (numUser > numCpu)
        printf("User Wins the Game!\n");
    else if (numUser < numCpu)
        printf("CPU Wins the Game!\n");
}
//how do we get it to run once when hitting enter
int main(){
    srand(time(NULL));
    int i;
    int cardsPerHand = 4;
    Deck cardStack[52];
    Deck cpuStack[50];
    Deck userStack[50];
    for (i = 0; i < 52; i++) {
        int suit = i / 13;
        int value = i % 13;
        cardStack[i].suit = 56 + suit;
        cardStack[i].value = value + 1;
    }
    shuffleDeck(cardStack);
    
    for (i = 0; i < cardsPerHand; i++) {
        cpuStack[i].value = cardStack[i].value;
        cpuStack[i].suit = cardStack[i].suit;
        
    }

    for (i = 0; i < cardsPerHand; i++) {
        userStack[i].value = cardStack[i+cardsPerHand].value;
        userStack[i].suit = cardStack[i+cardsPerHand].suit;
    }
    comparison(userStack,cpuStack);

    return 0;
}
